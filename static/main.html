<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>LineNews</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        header {
            padding: 12px 20px;
            background-color: #1f2d3d;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }
        header .title {
            font-size: 18px;
            font-weight: 600;
            margin-right: 20px;
        }
        .controls {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            flex: 1;
            min-width: 300px;
        }
        input[type="text"] {
            padding: 8px 12px;
            min-width: 200px;
            flex: 1;
            max-width: 400px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
        }
        button {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        #searchBtn {
            background-color: #409eff;
            color: #fff;
        }
        #searchBtn:hover {
            background-color: #66b1ff;
        }
        #timelineBtn {
            background-color: #67c23a;
            color: #fff;
        }
        #timelineBtn:hover {
            background-color: #85ce61;
        }
        #graphBtn {
            background-color: #e6a23c;
            color: #fff;
        }
        #graphBtn:hover {
            background-color: #eebb69;
        }
        .hint {
            padding: 8px 20px;
            font-size: 13px;
            color: #666;
            background-color: #f0f2f5;
        }
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            height: calc(100vh - 64px);
            box-sizing: border-box;
        }
        #resultContainer {
            flex: 1;
            background-color: #fff;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }
        #resultContainer .panel-header {
            padding: 8px 12px;
            border-bottom: 1px solid #ebeef5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #resultContainer .panel-title {
            font-size: 14px;
            font-weight: 600;
        }
        #resultContainer .panel-subtitle {
            font-size: 12px;
            color: #909399;
        }
        #resultContainer .panel-body {
            flex: 1;
            min-height: 0;
            overflow: auto;
        }
        #timelineChart,
        #graphChart {
            width: 100%;
            height: 100%;
        }
        #graphChart {
            background-color: #fff;
        }
        .timeline {
            position: relative;
            margin: 0;
            padding: 24px 24px 24px 56px;
            box-sizing: border-box;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 28px;
            top: 16px;
            bottom: 16px;
            width: 2px;
            background: linear-gradient(to bottom, #409eff, #a0cfff);
        }
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        .timeline-node {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: #fff;
            border: 3px solid #c0c4cc;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.9);
        }
        .timeline-node-latest {
            border-color: #409eff;
            box-shadow: 0 0 0 2px rgba(64,158,255,0.3);
        }
        .timeline-content {
            margin-left: 44px;
            padding: 12px 14px;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            border: 1px solid #ebeef5;
        }
        .timeline-meta {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 6px;
            margin-bottom: 6px;
            font-size: 12px;
            color: #909399;
        }
        .timeline-time,
        .timeline-location,
        .timeline-people {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 10px;
            background-color: #f4f4f5;
        }
        .timeline-time {
            background-color: #ecf5ff;
            color: #409eff;
            font-weight: 600;
        }
        .timeline-time::before {
            content: 'â± ';
        }
        .timeline-location::before {
            content: 'ğŸ“ ';
        }
        .timeline-people::before {
            content: 'ğŸ‘¤ ';
        }
        .timeline-title {
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            color: #303133;
            text-decoration: none;
            margin: 2px 0 4px;
        }
        .timeline-title:hover {
            color: #409eff;
            text-decoration: underline;
        }
        .timeline-summary {
            font-size: 13px;
            color: #606266;
            line-height: 1.6;
        }
        .timeline-empty {
            padding: 16px;
            font-size: 13px;
            color: #909399;
        }
        .hidden {
            display: none;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 14px;
            color: #666;
        }
        
        /* å“åº”å¼è®¾è®¡ - ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
                padding: 12px 16px;
            }
            
            header .title {
                margin-right: 0;
                text-align: center;
            }
            
            .controls {
                justify-content: center;
                flex-direction: row;
                align-items: center;
                flex-wrap: wrap;
            }
            
            input[type="text"] {
                min-width: 150px;
                flex: 1;
                margin-bottom: 0;
                max-width: none;
            }
            
            .controls button {
                margin-bottom: 0;
            }
            
            .hint {
                font-size: 12px;
                padding: 6px 16px;
            }
            
            .container {
                padding: 8px;
                height: calc(100vh - 100px);
            }
            
            #resultContainer .panel-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
            
            #resultContainer .panel-title {
                font-size: 16px;
            }
            
            #resultContainer .panel-subtitle {
                font-size: 11px;
            }
            
            .timeline {
                padding: 24px 16px 24px 44px;
            }
            
            .timeline-content {
                margin-left: 32px;
                padding: 10px 12px;
            }
            
            .timeline-title {
                font-size: 15px;
            }
            
            .timeline-summary {
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            header {
                padding: 10px 12px;
            }
            
            header .title {
                font-size: 16px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            input[type="text"] {
                padding: 8px;
                font-size: 16px; /* å¢å¤§å­—ä½“ä¾¿äºè§¦æ‘¸è¾“å…¥ */
                margin-bottom: 8px;
            }
            
            button {
                padding: 10px 16px;
                font-size: 16px; /* å¢å¤§å­—ä½“ä¾¿äºè§¦æ‘¸ */
            }
            
            .hint {
                font-size: 11px;
                padding: 6px 12px;
            }
            
            .timeline {
                padding: 20px 12px 20px 40px;
            }
            
            .timeline-node {
                left: 16px;
                width: 14px;
                height: 14px;
            }
            
            .timeline-content {
                margin-left: 28px;
                padding: 8px 10px;
            }
            
            .timeline-meta {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
    <!-- ECharts CDN -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
    <header>
        <div class="title">LineNews</div>
        <div class="controls">
            <input id="keywordInput" type="text" placeholder="è¾“å…¥æ–°é—»å…³é”®è¯ï¼Œä¾‹å¦‚ï¼šäººå·¥æ™ºèƒ½" />
            <button id="timelineBtn">æ—¶é—´çº¿</button>
            <button id="graphBtn">çŸ¥è¯†å›¾è°±</button>
        </div>
    </header>
    <div class="hint">è¯´æ˜ï¼šåœ¨ä¸Šæ–¹è¾“å…¥æ–°é—»å…³é”®è¯ï¼Œç‚¹å‡»"æ—¶é—´çº¿"æˆ–"çŸ¥è¯†å›¾è°±"æŒ‰é’®è·å–å¯¹åº”ç»“æœã€‚ç»“æœå°†é“ºæ»¡é™¤æœç´¢æ¡†å¤–çš„æ•´ä¸ªå±å¹•åŒºåŸŸã€‚</div>

    <div class="container">
        <div id="resultContainer" class="panel">
            <div class="panel-header">
                <div class="panel-title" id="resultTitle">ç­‰å¾…é€‰æ‹©åŠŸèƒ½</div>
                <div class="panel-subtitle" id="resultSubtitle">è¯·è¾“å…¥å…³é”®è¯å¹¶ç‚¹å‡»åŠŸèƒ½æŒ‰é’®</div>
            </div>
            <div class="panel-body">
                <div id="timelineChart" class="timeline hidden"></div>
                <div id="graphChart" class="hidden"></div>
                <div id="loadingIndicator" class="loading hidden">åŠ è½½ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        const timelineContainer = document.getElementById('timelineChart');
        const graphDom = document.getElementById('graphChart');
        const graphChart = echarts.init(graphDom);
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultTitle = document.getElementById('resultTitle');
        const resultSubtitle = document.getElementById('resultSubtitle');
        const origin = window.location.origin;
        const API_BASE = (!origin || origin === 'null' || origin.startsWith('file:')) ? 'http://localhost:8080' : origin;

        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
            timelineContainer.classList.add('hidden');
            graphDom.classList.add('hidden');
            resultTitle.textContent = 'åŠ è½½ä¸­...';
            resultSubtitle.textContent = 'æ­£åœ¨è·å–æ•°æ®ï¼Œè¯·ç¨å€™';
        }

        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            loadingIndicator.classList.add('hidden');
        }

        // æ˜¾ç¤ºæ—¶é—´çº¿ç»“æœ
        function showTimelineResult() {
            timelineContainer.classList.remove('hidden');
            graphDom.classList.add('hidden');
            resultTitle.textContent = 'æ—¶é—´çº¿è§†å›¾';
            resultSubtitle.textContent = 'æŒ‰æ—¶é—´é¡ºåºå±•ç¤ºé“¾å¼æ–°é—»äº‹ä»¶';
        }

        // æ˜¾ç¤ºå›¾è°±ç»“æœ
        function showGraphResult() {
            timelineContainer.classList.add('hidden');
            graphDom.classList.remove('hidden');
            resultTitle.textContent = 'çŸ¥è¯†å›¾è°±è§†å›¾';
            resultSubtitle.textContent = 'äº‹ä»¶ã€äººç‰©ã€åœ°ç‚¹ä¸ä¸»é¢˜çš„ç½‘çŠ¶å…³ç³»';
        }

        function loadTimeline(keyword) {
            showLoading();
            
            // åˆ›å»ºæ€è€ƒè¿‡ç¨‹æ˜¾ç¤ºåŒºåŸŸ
            const thinkingContainer = document.createElement('div');
            thinkingContainer.id = 'thinking-container';
            thinkingContainer.style.cssText = `
                padding: 16px;
                margin-bottom: 16px;
                background-color: #f0f9ff;
                border: 1px solid #b3d8ff;
                border-radius: 4px;
                max-height: 200px;
                overflow-y: auto;
            `;
            timelineContainer.innerHTML = '';
            timelineContainer.appendChild(thinkingContainer);
            
            resultTitle.textContent = 'æ—¶é—´çº¿ç”Ÿæˆä¸­...';
            resultSubtitle.textContent = 'æ­£åœ¨ç”Ÿæˆæ—¶é—´é“¾ï¼Œè¯·ç¨å€™';
            
            // ä½¿ç”¨ SSE è¿æ¥è·å–æµå¼æ•°æ®
            const eventSource = new EventSource(`${API_BASE}/api/timeline/stream?keyword=${encodeURIComponent(keyword)}`);
            
            eventSource.onmessage = function(event) {
                try {
                    const data = JSON.parse(event.data);
                    
                    if (data.type === 'thinking') {
                        // æ·»åŠ æ€è€ƒè¿‡ç¨‹åˆ°æ˜¾ç¤ºåŒºåŸŸ
                        const thinkingDiv = document.createElement('div');
                        thinkingDiv.style.cssText = `
                            padding: 8px 0;
                            border-bottom: 1px solid #ebeef5;
                            font-size: 14px;
                        `;
                        thinkingDiv.innerHTML = `<span style="color: #409eff; font-weight: 500;">[æ€è€ƒ] </span>${data.content}`;
                        thinkingContainer.appendChild(thinkingDiv);
                        
                        // æ»šåŠ¨åˆ°åº•éƒ¨
                        thinkingContainer.scrollTop = thinkingContainer.scrollHeight;
                    } else if (data.type === 'result') {
                        // æ”¶åˆ°æœ€ç»ˆç»“æœï¼Œæ¸²æŸ“æ—¶é—´çº¿
                        renderTimeline(data.content);
                        
                        // æ›´æ–°æ ‡é¢˜
                        resultTitle.textContent = 'æ—¶é—´çº¿è§†å›¾';
                        resultSubtitle.textContent = 'æŒ‰æ—¶é—´é¡ºåºå±•ç¤ºé“¾å¼æ–°é—»äº‹ä»¶';
                        
                        // ç§»é™¤æ€è€ƒè¿‡ç¨‹å®¹å™¨ï¼Œè®©æ—¶é—´çº¿æ­£å¸¸æ˜¾ç¤º
                        thinkingContainer.remove();
                    } else if (data.type === 'error') {
                        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                        const errorDiv = document.createElement('div');
                        errorDiv.style.cssText = `
                            padding: 8px;
                            color: #f56c6c;
                            font-weight: 500;
                        `;
                        errorDiv.textContent = `é”™è¯¯: ${data.content}`;
                        thinkingContainer.appendChild(errorDiv);
                        
                        // æ»šåŠ¨åˆ°åº•éƒ¨
                        thinkingContainer.scrollTop = thinkingContainer.scrollHeight;
                    } else if (data.type === 'done') {
                        // å®Œæˆæ—¶æ›´æ–°çŠ¶æ€
                        resultSubtitle.textContent = 'æ—¶é—´é“¾ç”Ÿæˆå®Œæˆ';
                    }
                } catch (e) {
                    console.error('è§£æSSEæ•°æ®å¤±è´¥:', e);
                }
            };
            
            eventSource.onerror = function(err) {
                console.error('SSEè¿æ¥é”™è¯¯:', err);
                eventSource.close();
                
                // é”™è¯¯å¤„ç†
                const errorDiv = document.createElement('div');
                errorDiv.className = 'timeline-empty';
                errorDiv.textContent = 'SSEè¿æ¥å¤±è´¥ï¼Œæ­£åœ¨å°è¯•æ™®é€šè¯·æ±‚...';
                thinkingContainer.appendChild(errorDiv);
                
                // å¦‚æœSSEå¤±è´¥ï¼Œå›é€€åˆ°æ™®é€šè¯·æ±‚
                fallbackToNormalRequest(keyword);
            };
        }
        
        // SSEå¤±è´¥æ—¶å›é€€åˆ°æ™®é€šè¯·æ±‚
        function fallbackToNormalRequest(keyword) {
            fetch(`${API_BASE}/api/timeline?keyword=${encodeURIComponent(keyword)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                    }
                    return response.json();
                })
                .then(data => {
                    renderTimeline(data);
                    showTimelineResult();
                })
                .catch(err => {
                    console.error(err);
                    hideLoading();
                    timelineContainer.innerHTML = '<div class="timeline-empty">è¯·æ±‚æ—¶é—´çº¿æ•°æ®å¤±è´¥ï¼Œè¯·ç¡®è®¤åç«¯å·²å¯åŠ¨ï¼ˆgo run main.goï¼‰ã€‚</div>';
                    showTimelineResult();
                });
        }

        async function loadGraph(keyword) {
            showLoading();
            try {
                const resp = await fetch(`${API_BASE}/api/graph?keyword=${encodeURIComponent(keyword)}`);
                if (!resp.ok) {
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                }
                const data = await resp.json();
                renderGraph(data);
                showGraphResult();
            } catch (err) {
                console.error(err);
                hideLoading();
                graphChart.clear();
                graphChart.setOption({
                    title: { text: 'çŸ¥è¯†å›¾è°±åŠ è½½å¤±è´¥', left: 'center' },
                    graphic: [{
                        type: 'text',
                        left: 'center',
                        top: 'middle',
                        style: {
                            text: 'è¯·æ±‚çŸ¥è¯†å›¾è°±æ•°æ®å¤±è´¥ï¼Œè¯·ç¡®è®¤åç«¯å·²å¯åŠ¨ï¼ˆgo run main.goï¼‰ã€‚',
                            fill: '#666',
                            fontSize: 14,
                        },
                    }],
                });
                showGraphResult();
            }
        }

        function renderTimeline(data) {
            hideLoading();
            const events = (data && data.events) || [];
            // æ¸…ç©ºå®¹å™¨
            timelineContainer.innerHTML = '';

            if (!events.length) {
                timelineContainer.innerHTML = '<div class="timeline-empty">æš‚æ— æ—¶é—´çº¿æ•°æ®</div>';
                return;
            }

            // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°åœ¨ä¸Šæ–¹ï¼‰
            const sortedEvents = events.slice().sort((a, b) => {
                const parseValue = (v) => {
                    if (!v) return null;
                    const d = new Date(v);
                    if (!isNaN(d.getTime())) {
                        return { type: 'date', value: d.getTime() };
                    }
                    const match = String(v).match(/(\d{4})/);
                    if (match) {
                        return { type: 'year', value: parseInt(match[1], 10) };
                    }
                    return { type: 'text', value: String(v) };
                };

                const ta = parseValue(a.time);
                const tb = parseValue(b.time);

                // æ²¡æœ‰æ—¶é—´çš„äº‹ä»¶æ’åœ¨åé¢
                if (!ta && !tb) return 0;
                if (!ta) return 1;
                if (!tb) return -1;

                // ç›¸åŒç±»å‹æŒ‰å€¼å€’åºï¼ˆæœ€æ–°åœ¨ä¸Šæ–¹ï¼‰
                if (ta.type === tb.type) {
                    if (ta.value === tb.value) return 0;
                    return ta.value < tb.value ? 1 : -1;
                }

                // å¯è§£æçš„æ—¶é—´ä¼˜å…ˆï¼Œå…¶æ¬¡æ˜¯å¹´ä»½ï¼Œæœ€åæ˜¯çº¯æ–‡æœ¬
                const typeOrder = { date: 0, year: 1, text: 2 };
                return typeOrder[ta.type] - typeOrder[tb.type];
            });

            sortedEvents.forEach((evt, idx) => {
                const peopleText = (evt.people || []).join('ã€') || '';
                const locationText = evt.location || '';
                const timeText = evt.time || '';
                const summaryText = evt.summary || '';
                const url =
                    evt.url ||
                    `https://news.example.com/search?q=${encodeURIComponent(evt.title || data.keyword || '')}`;

                const item = document.createElement('div');
                item.className = 'timeline-item';

                const node = document.createElement('div');
                node.className = 'timeline-node' + (idx === 0 ? ' timeline-node-latest' : '');
                item.appendChild(node);

                const content = document.createElement('div');
                content.className = 'timeline-content';

                const meta = document.createElement('div');
                meta.className = 'timeline-meta';
                let metaHtml = '';
                if (timeText) {
                    metaHtml += `<span class="timeline-time">${timeText}</span>`;
                }
                if (locationText) {
                    metaHtml += '<span class="timeline-separator">Â·</span>' +
                        `<span class="timeline-location">${locationText}</span>`;
                }
                if (peopleText) {
                    metaHtml += '<span class="timeline-separator">Â·</span>' +
                        `<span class="timeline-people">${peopleText}</span>`;
                }
                meta.innerHTML = metaHtml;
                content.appendChild(meta);

                const titleLink = document.createElement('a');
                titleLink.className = 'timeline-title';
                titleLink.textContent = evt.title || 'æœªå‘½åäº‹ä»¶';
                if (url) {
                    titleLink.href = url;
                    titleLink.target = '_blank';
                } else {
                    titleLink.href = 'javascript:void(0)';
                }
                content.appendChild(titleLink);

                if (summaryText) {
                    const summaryEl = document.createElement('div');
                    summaryEl.className = 'timeline-summary';
                    summaryEl.textContent = summaryText;
                    content.appendChild(summaryEl);
                }

                item.appendChild(content);
                timelineContainer.appendChild(item);
            });
        }

        function renderGraph(data) {
            hideLoading();
            const nodes = data.nodes || [];
            const links = data.links || [];

            // æ¯æ¬¡æ¸²æŸ“å‰å…ˆæ¸…ç©ºå›¾è¡¨ï¼Œé¿å…å¤šæ¬¡ç»“æœå †å 
            graphChart.clear();

            if (!nodes.length) {
                graphChart.clear();
                graphChart.setOption({
                    title: { text: 'æš‚æ— çŸ¥è¯†å›¾è°±æ•°æ®', left: 'center' },
                });
                return;
            }

            const categoryMap = new Map();
            const categories = [];
            nodes.forEach((n) => {
                if (!categoryMap.has(n.category)) {
                    categoryMap.set(n.category, categories.length);
                    categories.push({ name: n.category });
                }
            });

            const graphNodes = nodes.map((n) => {
                const catIndex = categoryMap.get(n.category) ?? 0;
                return {
                    id: n.id,
                    name: n.name,
                    category: catIndex,
                    symbolSize: 60,
                    label: { show: true },
                    tooltip: {
                        formatter: `åç§°ï¼š${n.name}<br />ç±»å‹ï¼š${n.category}`,
                    },
                };
            });

            const graphLinks = links.map((l) => ({
                source: l.source,
                target: l.target,
                value: l.relation,
                label: {
                    show: false,
                    formatter: l.relation,
                },
                tooltip: {
                    formatter: `å…³ç³»ï¼š${l.relation}`,
                },
            }));

            const option = {
                backgroundColor: '#ffffff',
                title: {
                    text: `å…³é”®è¯ï¼š${data.keyword || ''} çš„æ–°é—»çŸ¥è¯†å›¾è°±`,
                    left: 'center',
                    top: 10,
                },
                tooltip: {
                    trigger: 'item',
                    formatter: function (params) {
                        if (params.dataType === 'node' && params.data && params.data.tooltip) {
                            return params.data.tooltip.formatter;
                        }
                        if (params.dataType === 'edge' && params.data && params.data.tooltip) {
                            return params.data.tooltip.formatter;
                        }
                        return params.name || '';
                    },
                },
                legend: [{
                    data: categories.map((c) => c.name),
                    orient: 'vertical',
                    left: 10,
                    top: 60,
                }],
                series: [
                    {
                        type: 'graph',
                        layout: 'force',
                        data: graphNodes,
                        links: graphLinks,
                        categories: categories,
                        roam: true,
                        focusNodeAdjacency: true,
                        force: {
                            repulsion: 120,
                            edgeLength: 120,
                        },
                        label: {
                            position: 'inside',
                            color: '#fff',
                        },
                        lineStyle: {
                            color: '#aaa',
                            width: 1.5,
                            curveness: 0.1,
                        },
                        edgeSymbol: ['none', 'arrow'],
                        edgeSymbolSize: 8,
                    },
                ],
            };

            graphChart.setOption(option);
        }

        // ä¸ºæ—¶é—´çº¿æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('timelineBtn').addEventListener('click', function () {
            const input = document.getElementById('keywordInput');
            const keyword = (input.value || '').trim();
            if (!keyword) {
                alert('è¯·è¾“å…¥æ–°é—»å…³é”®è¯åå†æœç´¢');
                return;
            }
            // æ¸…ç©ºä¹‹å‰çš„æ˜¾ç¤ºå†…å®¹
            timelineContainer.innerHTML = '';
            graphChart.clear();
            // åŠ è½½æ—¶é—´çº¿æ•°æ®
            loadTimeline(keyword);
        });

        // ä¸ºå›¾è°±æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('graphBtn').addEventListener('click', function () {
            const input = document.getElementById('keywordInput');
            const keyword = (input.value || '').trim();
            if (!keyword) {
                alert('è¯·è¾“å…¥æ–°é—»å…³é”®è¯åå†æœç´¢');
                return;
            }
            // æ¸…ç©ºä¹‹å‰çš„æ˜¾ç¤ºå†…å®¹
            timelineContainer.innerHTML = '';
            graphChart.clear();
            // åŠ è½½å›¾è°±æ•°æ®
            loadGraph(keyword);
        });

        // æ”¯æŒå›è½¦é”®è§¦å‘æ—¶é—´çº¿æœç´¢
        document.getElementById('keywordInput').addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                document.getElementById('timelineBtn').click();
            }
        });

        window.addEventListener('resize', function () {
            graphChart.resize();
        });

        // é¡µé¢åŠ è½½æ—¶ä¸è¿›è¡Œè‡ªåŠ¨æ£€ç´¢ï¼Œç­‰å¾…ç”¨æˆ·æ‰‹åŠ¨è¾“å…¥å…³é”®è¯å¹¶ç‚¹å‡»æŒ‰é’®
    </script>
</body>
</html>